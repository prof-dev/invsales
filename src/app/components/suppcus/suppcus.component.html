<div id="map" class="map"></div>
<mat-expansion-panel>
    <mat-expansion-panel-header>
        {{location}} انقر على الخريطه
    </mat-expansion-panel-header>
    <mat-card>
        <br>
        <button mat-raised-button color="primary" (click)="setType('c')">إدخال عميل</button>&nbsp;
        <button mat-raised-button color="primary" (click)="setType('s')">إدخال مورد</button>
        <br>
        <h1 mat-dialog-title> إدخال بيانات {{formtype}}</h1>

        <div mat-dialog-content *ngIf="supcus.type!=''">

            <mat-form-field>
                <input matInput required placeholder="الإسم " [(ngModel)]="supcus.namear">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" الرصيد المبدئي" [(ngModel)]="supcus.amount" [disabled]="processinfo.disbalance">
            </mat-form-field>
            <mat-form-field *ngIf="supcus.type=='c'">
                <input matInput required placeholder=" فرع العميل" [(ngModel)]="supcus.data.branch">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder="  إسم الترحيلات" [(ngModel)]="supcus.data.transport">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder="  رقم الترحيلات" [(ngModel)]="supcus.data.transphone">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" إسم المشتريات" [(ngModel)]="supcus.data.purname">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" رقم المشتريات" [(ngModel)]="supcus.data.purphone">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" واتس  المشتريات" [(ngModel)]="supcus.data.purwhats">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder="  التصنيف" [(ngModel)]="supcus.data.class">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder="   التخصص" [(ngModel)]="supcus.data.domain">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" موبايل" [(ngModel)]="supcus.data.phone">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" موبايل 2" [(ngModel)]="supcus.data.phone2">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" بريد إلكتروني" [(ngModel)]="supcus.data.email">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" رقم الواتساب" [(ngModel)]="supcus.data.whatsapp">
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder="العنوان على الخريطة" [(ngModel)]="supcus.data.location" [value]="location">
            </mat-form-field>
            <br>
            <!-- capture the location from the map save it to supcus.data.location -->



        </div>
        <div mat-dialog-actions>
            <button mat-raised-button (click)="save(form)" color='primary' *ngIf="supcus.type!=''">حفظ</button>
            <button mat-raised-button (click)="onNoClick()" color='warn'>تراجع</button>


        </div>
        <hr>
        <div mat-dialog-content *ngIf="processinfo.operation==1">
            <mat-form-field>
                <textarea matInput required placeholder="التعليق " name="paid" [(ngModel)]="sadad.desc" required></textarea>
            </mat-form-field>
            <br>
            <h3> الدفع</h3>
            <mat-form-field>
                <select matNativeControl required class="primary" [(ngModel)]="payment.paymentmethod" placeholder="طريقة الدفع">
                    <option *ngFor="let ch of paymentmethods" [(value)]="ch.value">{{ch.viewValue}} </option>

                </select>
            </mat-form-field>
            <mat-form-field>
                <input matInput required placeholder=" المدفوع" name="total" [(ngModel)]="paid" required>
            </mat-form-field>


            <div *ngIf="payment.paymentmethod=='check'">
                <mat-form-field>
                    <input matInput required placeholder="قيمة الشيك " name="paid" [(ngModel)]="payment.amount"
                        required>
                </mat-form-field>
                <mat-form-field>
                    <input matInput required placeholder="رقم الشيك" name="reminder" [(ngModel)]="payment.checkno"
                        required>
                </mat-form-field>
                <mat-form-field>
                    <input matInput required placeholder="اسم البنك " name="paid" [(ngModel)]="payment.bankname"
                        required>
                </mat-form-field>
                <mat-form-field>
                    <input matInput [matDatepicker]="date" placeholder=" تاريخ الشيك" [(ngModel)]="payment.date">
                    <mat-datepicker-toggle matSuffix [for]="date"></mat-datepicker-toggle>
                    <mat-datepicker #date></mat-datepicker>
                </mat-form-field>
                <mat-form-field>
                    <input matInput required placeholder="حساب بإسم " name="reminder" [(ngModel)]="payment.checkowner"
                        required>
                </mat-form-field>
                <mat-form-field>
                    <select matNativeControl required class="primary" [(ngModel)]="payment.checkstatus" placeholder=" حالة الشيك"
                        (focusout)="pushpayment(payment)">
                        <option *ngFor="let ch of checkstatus" [(value)]="ch.value">{{ch.viewValue}} </option>

                    </select>
                </mat-form-field>
            </div>

            <div *ngIf="payment.paymentmethod=='cash'">
                <mat-form-field>
                    <input matInput required placeholder="المدفوع " name="paid" [(ngModel)]="payment.amount" required
                        (focusout)="pushpayment(payment)">
                </mat-form-field>

            </div>
            <!-- <button mat-raised-button (click)="addpayment(payment)">
                        <img src="assets/icnAdd.png" alt="" width="32" class="btn-img">
                      </button> -->

            <div>
                <h4>ملخص الدفع</h4>
                <table>
                    <tr>
                        <th>
                            الملبلغ
                        </th>
                        <th>
                            طريقة الدفع
                        </th>
                        <th>
                            رقم الشيك
                        </th>

                        <th>
                            العمليات
                        </th>
                    </tr>
                    <tr *ngFor="let row of payments;let i=index;">
                        <td>{{row.amount}}</td>
                        <td>{{row.paymentmethod}}</td>
                        <td>{{row.checkno}}</td>
                        <td>
                            <img src="assets/icnEdit.png" alt="" width="32" class="btn-img" (click)="editPayment(row)">
                            <img src="assets/icnDelete.png" alt="" width="32" class="btn-img" (click)="deletePayment(index,row)">
                        </td>
                    </tr>
                </table>

            </div>

            <button mat-raised-button (click)="savePayment()" n *ngIf="sadad.id==null">
                <img src="assets/icnSave.png" alt="" width="32" class="btn-img">
            </button>
            <button *ngIf="sadad.id!=null" mat-raised-button (click)="print(payment)">
                طباعة ايصال
            </button>


            <div class="printdiv" hidden="true">
                <table>
                    <tr>
                        <td>
                            رقم المعاملة: {{sadad.id}}
                        </td>
                    </tr>
                    <tr>
                        <td *ngIf="supcus.type=='c'">
                            إسم العميل : {{supcus.namear}}
                        </td>
                        <td *ngIf="supcus.type=='s'">
                            إسم المورد : {{supcus.namear}}
                        </td>
                    </tr>
                    <tr>
                        <td *ngIf="supcus.type=='c'">
                            جملة المستلم : {{paid}}
                        </td>
                        <td *ngIf="supcus.type=='s'">
                            جملة المدفوع : {{paid}}
                        </td>
                    </tr>
                    <tr>
                        <table>
                            <thead>
                                <tr>
                                    <th>
                                        طريقة الدفع
                                    </th>
                                    <th>
                                        رقم الشيك
                                    </th>
                                    <th>
                                        الملبلغ
                                    </th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let row of payments;let i=index;">
                                    <td>{{row.paymentmethod}}</td>
                                    <td>{{row.checkno}}</td>
                                    <td>{{row.amount}}</td>



                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        جملة المدفوع او المستلم : {{paid}}
                                    </td>
                                </tr>
                        </table>
                    </tr>


                    </tbody>

                </table>
            </div>
        </div>


        <div *ngIf="operation != 0">


            <h2>{{formtype}}</h2>

            <table class="responsive">
                <tr>
                    <th>الرقم</th>
                    <th>الإسم</th>
                    <th>رقم الهاتف</th>
                    <th>الموبايل</th>
                    <th>الواتساب</th>
                    <th>الايميل</th>
                    <th *ngIf="supcus.type=='c'">الفرع</th>
                    <th>الرصيد</th>
                    <th>تعديل</th>
                </tr>
                <tr *ngFor="let row of suppcus  ">
                    <td>{{row.id}}</td>
                    <td>{{row.namear}}</td>
                    <td>{{row.data.phone}}</td>
                    <td>{{row.data.phone2}}</td>
                    <td>{{row.data.whatsapp}}</td>
                    <td>{{row.data.email}}</td>
                    <td *ngIf="supcus.type=='c'">{{row.data.branch}}</td>
                    <td>{{row.amount}}</td>
                    <td>
                        <button mat-raised-button color="primary" (click)="modify(row)">تعديل</button>
                    </td>
                    <td *ngIf="row.type=='s'">
                        <button mat-raised-button color="primary" (click)="pay(row)">دفعيات</button>
                    </td>
                    <td *ngIf="row.type=='c'">
                        <button mat-raised-button color="primary" (click)="pay(row)">إستلام مبالغ</button>
                    </td>


                </tr>
            </table>


        </div>


    </mat-card>
</mat-expansion-panel>